version: '3'

vars:
  RUN_DIR_RESOLVED: '{{default .TASKFILE_DIR .RUN_DIR}}'

tasks:
  build:
    desc: Build docker container with tag
    requires:
      vars:
        - IMAGE
        - TAG
    vars:
      BUILD_DIR: '{{.BUILD_DIR | default "."}}'
    cmds:
      - >-
        cd {{.RUN_DIR_RESOLVED}} &&
        nix develop --command docker build {{.BUILD_OPTS}} -t {{.IMAGE}}:{{.TAG}} {{.BUILD_DIR}}
